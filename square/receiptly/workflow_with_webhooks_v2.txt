Final Workflow Summary:

    For Previously Encountered Customers (those who have already opted for Receiptly):
        Webhooks are processed automatically.
        When Receiptly receives a webhook with a card fingerprint it recognizes (from a previous transaction), it automatically sends the receipt without needing the customer to reselect Receiptly.
    For New Customers (those who are using Receiptly for the first time):
        Square POS will explicitly call the /notify_payment endpoint when the customer selects Receiptly as the receipt option during checkout.
        Receiptly will then ask for the customer's email or phone number, store their details along with the card fingerprint, and send the receipt.

Final Workflow Details:

    Webhooks:
        Only process transactions where the card fingerprint is already known in Receiptly's system.
        For new fingerprints (customers who havenâ€™t used Receiptly before), Receiptly ignores the webhook.
    /notify_payment:
        This endpoint is triggered when a new customer explicitly chooses Receiptly as the receipt option.
        Receiptly asks for their contact information and saves it for future use (to handle future transactions via webhooks).

Why This Works:

    Efficiency: Receiptly only processes webhooks for returning customers, ensuring that existing customers get their receipts automatically.
    Selective Engagement: For new customers, you avoid unnecessary actions and only engage when they opt into Receiptly through the /notify_payment endpoint.
